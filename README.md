curl -X 'GET' \
  'http://localhost:8089/client-sysprin-reader/api/client/0003' \
  -H 'accept: */*'



  [
  {
    "client": "0003",
    "name": "0003 client name",
    "addr": "0003 address line",
    "city": "king of prussia",
    "state": "AK",
    "zip": "19765",
    "contact": "0003 contact",
    "phone": "415-432-4322",
    "active": true,
    "faxNumber": "543-267-6544",
    "billingSp": "198754",
    "reportBreakFlag": 0,
    "chLookUpType": 0,
    "excludeFromReport": true,
    "positiveReports": true,
    "subClientInd": true,
    "subClientXref": "5624",
    "amexIssued": true,
    "reportOptions": [
      {
        "clientId": "0003",
        "reportId": 191,
        "receiveFlag": true,
        "outputTypeCd": 1,
        "fileTypeCd": 1,
        "emailFlag": 1,
        "emailBodyTx": "email body 191",
        "reportPasswordTx": "725667",
        "reportDetails": {
          "reportId": 191,
          "queryName": "Binary - Rapid Daily Activity Report updated      ",
          "query": "Exec USP_ClientDailyActivity_6056 '6056'",
          "inputDataFields": "Client/Start Date/End Date                                                                                                                                                                                                                                     ",
          "fileExt": "TXT",
          "dbDriverType": "{SQL SERVER}                  ",
          "fileHeaderInd": 1,
          "defaultFileNm": "Binary",
          "reportDbServer": "W3DVDS1051",
          "reportDb": "Rapid3",
          "reportDbUserid": "svc-fdpd-tag",
          "reportDbPasswrd": "D9EE541990967B8D12753C8CD5A6E946",
          "fileTransferType": 1,
          "reportDbIpAndPort": "",
          "reportByClientFlag": false,
          "rerunDateRangeStart": null,
          "rerunDateRangeEnd": null,
          "rerunClientId": null,
          "emailFromAddress": "rapid.reports@firstdatacorp.com",
          "emailEventId": "                                                  ",
          "tabDelimitedFlag": false,
          "inputFileTx": "",
          "inputFileKeyStartPos": 0,
          "inputFileKeyLength": 0,
          "accessLevel": 6,
          "isActive": true,
          "isVisible": true,
          "numSheets": null,
          "c3FileTransfer": null
        }
      }
    ],
    "sysPrinsPrefixes": [],
    "clientEmail": [
      {
        "clientId": "0003",
        "emailAddressTx": "0003.01@gmail.com",
        "reportId": 110,
        "emailNameTx": "0003 name 01",
        "carbonCopyFlag": true,
        "activeFlag": true,
        "mailServerId": 0
      }
    ],
    "sysPrins": [
      {
        "client": "0003",
        "clientIds": null,
        "sysPrin": "12121898",
        "custType": "1",
        "undeliverable": "1",
        "statA": "0",
        "statB": "0",
        "statC": "1",
        "statD": "1",
        "statE": "0",
        "statF": "0",
        "statI": "0",
        "statL": "0",
        "statO": "0",
        "statU": "0",
        "statX": "0",
        "statZ": "0",
        "poBox": "1",
        "addrFlag": "1",
        "tempAway": 1234,
        "rps": "1",
        "session": "",
        "badState": "1",
        "astatRch": "1",
        "nm13": "1",
        "tempAwayAtts": 12345,
        "reportMethod": 0,
        "sysPrinActive": "1",
        "notes": "Notes for 38383838 updated updated 12121813 updated updated updated 888  for 87878787 87878787 this is new updated new update",
        "returnStatus": "A",
        "destroyStatus": "1",
        "nonUS": "1",
        "special": "1",
        "pinMailer": "1",
        "holdDays": 1145,
        "forwardingAddress": "1",
        "sysPrinContact": "",
        "sysPrinPhone": "",
        "entityCode": "0",
        "invalidDelivAreas": null,
        "vendorSentTo": null,
        "vendorReceivedFrom": null
      },
      {
        "client": "0003",
        "clientIds": null,
        "sysPrin": "28282829",
        "custType": "1",
        "undeliverable": "1",
        "statA": "0",
        "statB": "0",
        "statC": "1",
        "statD": "1",
        "statE": "0",
        "statF": "0",
        "statI": "0",
        "statL": "0",
        "statO": "0",
        "statU": "0",
        "statX": "0",
        "statZ": "0",
        "poBox": "1",
        "addrFlag": "0",
        "tempAway": 1234,
        "rps": "0",
        "session": " ",
        "badState": "1",
        "astatRch": "0",
        "nm13": "0",
        "tempAwayAtts": 12345,
        "reportMethod": 0,
        "sysPrinActive": "0",
        "notes": "Notes for 38383838 updated updated 12121813 updated updated updated 888  for 87878787 87878787 this is new updated",
        "returnStatus": "A",
        "destroyStatus": "1",
        "nonUS": "1",
        "special": "1",
        "pinMailer": "1",
        "holdDays": 1145,
        "forwardingAddress": "1",
        "sysPrinContact": "",
        "sysPrinPhone": "",
        "entityCode": "0",
        "invalidDelivAreas": null,
        "vendorSentTo": null,
        "vendorReceivedFrom": null
      },
      {
        "client": "0003",
        "clientIds": null,
        "sysPrin": "43434343",
        "custType": "1",
        "undeliverable": "1",
        "statA": "0",
        "statB": "0",
        "statC": "1",
        "statD": "1",
        "statE": "0",
        "statF": "0",
        "statI": "0",
        "statL": "0",
        "statO": "0",
        "statU": "0",
        "statX": "0",
        "statZ": "0",
        "poBox": "1",
        "addrFlag": "0",
        "tempAway": 1234,
        "rps": "0",
        "session": " ",
        "badState": "1",
        "astatRch": "0",
        "nm13": "0",
        "tempAwayAtts": 12345,
        "reportMethod": 0,
        "sysPrinActive": "0",
        "notes": "Notes for 38383838 updated updated 12121813 updated updated updated 888  for 87878787 87878787 this is new updated",
        "returnStatus": "A",
        "destroyStatus": "1",
        "nonUS": "1",
        "special": "1",
        "pinMailer": "1",
        "holdDays": 1145,
        "forwardingAddress": "1",
        "sysPrinContact": "",
        "sysPrinPhone": "",
        "entityCode": "0",
        "invalidDelivAreas": null,
        "vendorSentTo": null,
        "vendorReceivedFrom": null
      }
    ]
  }
]






// ClientIntegrationService.jsx
// Utilities for talking to the backend (gateway + reader + search-integration)

const GATEWAY_BASE_URL =
  import.meta.env?.VITE_GATEWAY_BASE_URL || 'http://localhost:8089';

/**
 * Helper to build a URL with query params.
 */
function buildUrl(path, params = {}) {
  const url = new URL(path, GATEWAY_BASE_URL);
  Object.entries(params).forEach(([key, value]) => {
    if (value !== undefined && value !== null) {
      url.searchParams.append(key, String(value));
    }
  });
  return url.toString();
}

/**
 * Generic fetch wrapper.
 * - Throws on non-2xx
 * - Returns JSON if possible, otherwise text.
 */
export async function fetchJson(url, options = {}) {
  const res = await fetch(url, {
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json',
      ...(options.headers || {}),
    },
    ...options,
  });

  if (!res.ok) {
    const text = await res.text().catch(() => '');
    const error = new Error(
      `HTTP ${res.status} ${res.statusText} for ${url} :: ${text || 'No body'}`
    );
    error.status = res.status;
    error.body = text;
    throw error;
  }

  const contentType = res.headers.get('content-type') || '';
  if (contentType.includes('application/json')) {
    return res.json();
  }
  return res.text();
}

/**
 * Autocomplete search for clients.
 *
 * Backend (adjust if your path is different):
 *   GET /search-integration/api/client-autocomplete?keyword=...
 *
 * Used by: ClientAutoCompleteInputBox
 */
export async function fetchClientSuggestions(keyword) {
  if (!keyword || !keyword.trim()) return [];

  const url = buildUrl('/search-integration/api/client-autocomplete', {
    keyword: keyword.trim(),
  });

  const data = await fetchJson(url, { method: 'GET' });

  // Some gateways return { data: [...] }, some return []
  if (data && Array.isArray(data.data)) return data.data;
  if (Array.isArray(data)) return data;
  return [];
}

/**
 * Paged list of clients for the left NavigationPanel.
 *
 * Backend example (adjust path if needed):
 *   GET /client-sysprin-reader/api/clients-paging?page={page}&size={size}
 */
export async function fetchClientsPaging(page = 0, size = 5) {
  const url = buildUrl('/client-sysprin-reader/api/clients-paging', {
    page,
    size,
  });

  const data = await fetchJson(url, { method: 'GET' });

  // Could be Page<ClientDTO> or plain array
  if (data && Array.isArray(data.content)) return data.content;
  if (Array.isArray(data)) return data;
  return [];
}

/**
 * Wildcard / multi-page search for clients.
 *
 * You may already have an endpoint for this in your backend.
 * Adjust the path to whatever you implemented. For example:
 *   GET /client-sysprin-reader/api/clients-search?keyword={kw}&page={page}&size={size}
 */
export async function fetchWildcardPage(keyword, page = 0, size = 20) {
  const kw = (keyword || '').trim();
  if (!kw) return [];

  const url = buildUrl('/client-sysprin-reader/api/clients-search', {
    keyword: kw,
    page,
    size,
  });

  const data = await fetchJson(url, { method: 'GET' });

  if (data && Array.isArray(data.content)) return data.content;
  if (Array.isArray(data)) return data;
  return [];
}

/**
 * NEW: fetch full client detail (client + sysPrins + emails + reportOptions)
 *
 * Now calls:
 *
 *   GET /client-sysprin-reader/api/client/{client}
 *
 * Example:
 *   GET /client-sysprin-reader/api/client/0003
 *
 * Response shape (your example):
 *   [
 *     {
 *       client: "0003",
 *       name: "...",
 *       reportOptions: [...],
 *       sysPrins: [...],
 *       clientEmail: [...],
 *       ...
 *     }
 *   ]
 *
 * We normalize this to a single object:
 *   { client: "0003", ... }
 */
export async function fetchClientDetail(client) {
  if (!client) throw new Error('client is required');

  const path = `/client-sysprin-reader/api/client/${encodeURIComponent(client)}`;
  const url = new URL(path, GATEWAY_BASE_URL).toString();

  const data = await fetchJson(url, { method: 'GET' });

  // Optional debug:
  // console.log('fetchClientDetail raw data:', data);

  if (Array.isArray(data)) {
    return data[0] || null;
  }
  return data || null;
}

